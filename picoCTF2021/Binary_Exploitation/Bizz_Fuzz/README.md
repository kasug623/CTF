# Lessons
- `Ghidrathon`
  - https://github.com/mandiant/Ghidrathon  
- vuln pattern of `fgets()`
    ```c
    char *fgets(char *str, int length, FILE *stream);
    ```
    vuln : length > size of stream(buffer)  

- `__libc_start_main`
  ```c
  __libc_start_main(FUN_0814c22c,param_2,&stack0x00000004,FUN_0814c6d0,FUN_0814c730,param_1,
                    auStack_4);
  ```
  `__libc_start_main` is a function provided by the GNU C Library (glibc) in C programming.  
  It serves as the entry point for C programs, initiating the program's execution.  

  Typically, a C program begins with the main function:  

  ```C
  int main(int argc, char *argv[], char *envp[])
  ```
  However, main is indirectly called by `__libc_start_main`, which initializes the C runtime environment and ensures proper execution of the program.  
  This function is responsible for program initialization and calling the main function. It guarantees that the C runtime environment is properly initialized for the program's execution.

  The syntax of __libc_start_main function is:
  ```c
  int __libc_start_main(int (*main) (int, char **, char **),
                        int argc, char *__unbounded *__unbounded ubp_av,
                        void (*init) (void), void (*fini) (void),
                        void (*rtld_fini) (void), void *__unbounded stack_end);
  ```
  The parameters of this function are interpreted as follows:

  - main: Pointer to the main function.  
  - argc: Number of command-line arguments passed to main.  
  - ubp_av: Pointer array to command-line arguments.  
  - init: Pointer to the program's initialization function.  
  - fini: Pointer to the program's finalization function.  
  - rtld_fini: Pointer to the dynamic linker's finalization function.  
  - stack_end: Pointer to the end of the stack.  
  These parameters are used for various initialization, execution, and finalization tasks of the program. __libc_start_main is typically set as the entry point for the executable file, but it can also be explicitly called by users if needed.


# Memo
1. check
```zsh
$ file ./vuln
./vuln: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=836e2f666bd53c2307bff4801d330e444556a006, stripped
$ checksec --file=./vuln --output=json | jq .
{
  "./vuln": {
    "relro": "partial",
    "canary": "no",
    "nx": "yes",
    "pie": "no",
    "rpath": "no",
    "runpath": "no",
    "symbols": "no",
    "fortify_source": "no",
    "fortified": "0",
    "fortify-able": "2"
  }
}
```

2. check logic

3. test
- `Ghidrathon`
```py
fgets = toAddr(0x80484a0) # get this address from GUI
xrefs = currentProgram().getReferenceManager().getReferencesTo(fgets)

for xref in xrefs:
  type(xref)
  break

<class 'ghidra.program.database.references.MemReferenceDB'>

for xref in xrefs:
  a = xref.getFromAddress()
  call = getInstructionAt(a)
  print(call)
  break

CALL 0x080484a0

# error: xrefs[0].getFromAddress()
# error messafge ...'BigRefListV0$RefIterator' object is not subscriptable#
# ...This part specifically points to the cause of the error. It means that the object named "BigRefListV0$RefIterator" cannot be accessed using indexes like a list.
next(xrefs).getFromAddress()

>>> a = next(xrefs).getFromAddress()
>>> call = getInstructionAt(a)
>>> print(call)
CALL 0x080484a0
>>> push_buffer = getInstructionBefore(a)
>>> print(push_buffer)
PUSH EAX
>>> set_buffer = getInstructionBefore(push_buffer)
>>> print(set_buffer)
LEA EAX,[EBP + -0x3e]
>>> push_len = getInstructionBefore(set_buffer)
>>> print(push_len)
PUSH 0x27
```
```
        080488b4 83  ec  04       SUB        ESP ,0x4
        080488b7 50              PUSH       EAX
        080488b8 6a  27           PUSH       0x27
        080488ba 8d  45  c2       LEA        EAX =>local_42 ,[EBP  + -0x3e ]
        080488bd 50              PUSH       EAX
        080488be e8  dd  fb       CALL       <EXTERNAL>::fgets     ...    char * fgets(char * __s, int __n
                 ff  ff
        080488c3 83  c4  10       ADD        ESP ,0x10
```

# Ref  
- https://miso-24.hatenablog.com/entry/2021/04/13/214713#Bizz-Fuzz
- https://enigmatrix.me/blog/2021/04/11/pico-ctf-2021-bizz-fuzz